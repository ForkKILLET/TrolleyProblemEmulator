(()=>{var A=(e,t)=>()=>(e&&(t=e(e=0)),t);var O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var m,k,y,p,f,b=A(()=>{m={"#":"black","!":"red",".":"ivory","?":"yellow","@":"cornflowerblue","+":"forestgreen","*":"chartreuse","%":"lightgrey","/":"grey"," ":"white","=":"sienna","-":"transparent",x:null},k=Object.keys(m),y=()=>k[~~(Math.random()*1e6)%(k.length-2)],p={icelava:{A:`
 ### 
#   #
#####
#   #
#   #
`,B:`
#### 
#   #
#### 
#   #
#### 
`,C:`
 ####
#    
#    
#    
 ####
`,D:`
#### 
#   #
#   #
#   #
#### 
`,E:`
#####
#    
#### 
#    
#####
`,F:`
#####
#    
#### 
#    
#    
`,G:`
 ####
#    
# ###
#   #
 ####
`,H:`
#   #
#   #
#####
#   #
#   #
`,I:`
#####
  #  
  #  
  #  
#####
`,J:`
#####
   # 
   # 
#  # 
 ##  
`,K:`
#  ##
# #  
##   
# #  
#  ##
`,L:`
#    
#    
#    
#    
#####
`,M:`
#   #
## ##
# # #
#   #
#   #
`,N:`
#   #
##  #
# # #
#  ##
#   #
`,O:`
 ### 
#   #
#   #
#   #
 ### 
`,P:`
#### 
#   #
#### 
#    
#    
`,Q:`
 ### 
#   #
### #
# #  
 # ##
`,R:`
#### 
#   #
#### 
#  # 
#   #
`,S:`
 ####
#    
 ### 
    #
#### 
`,T:`
#####
  #  
  #  
  #  
  #  
`,U:`
#   #
#   #
#   #
#   #
 ### 
`,V:`
#   #
#   #
#   #
 # # 
  #  
`,W:`
#   #
# # #
# # #
# # #
 # # 
`,X:`
#   #
 # # 
  #  
 # # 
#   #
`,Y:`
#   #
 # # 
  #  
  #  
  #  
`,Z:`
#####
   # 
  # 
 #   
#####
`,"0":`
#### 
#  # 
#  # 
#  # 
#### 
`,"1":`
#    
#    
#    
#    
#    
`,"2":`
#### 
   # 
#### 
#    
#### 
`,"3":`
#### 
   # 
#### 
   # 
#### 
`,"4":`
#  # 
#  # 
#### 
   # 
   # 
`,"5":`
#### 
#    
#### 
   # 
#### 
`,"6":`
#### 
#    
#### 
#  # 
#### 
`,"7":`
#### 
   # 
  ## 
   # 
   # 
`,"8":`
#### 
#  # 
#### 
#  # 
#### 
`,"9":`
#### 
#  # 
#### 
   # 
#### 
`," ":`
     
     
     
     
     
`,".":`
     
     
     
     
 #   
`,",":`
     
     
     
 #   
#    
`,"!":`
  #  
  #  
  #  
     
  #  
`,"?":`
#####
    #
  ## 
     
  #  
`,"#":`
 # # 
#####
 # # 
#####
 # # 
`,"/":`
    #
   # 
  #  
 #   
#    
`,"\\":`
#     
 #   
  #  
   # 
    #
`,"|":`
  #  
  #  
  #  
  #  
  #  
`,"+":`
     
  #  
 ### 
  #  
     
`,"-":`
     
     
 ### 
     
     
`,_:`
     
     
     
     
 ### 
`,"=":`
     
 ### 
     
 ### 
     
`,"*":`
     
 # # 
  #  
 # # 
     
`,":":`
     
 #   
     
 #   
     
`,";":`
     
 #   
     
 #   
#    
`,"@":`
#### 
    #
 ## #
# # #
## ##
`,"%":`
##  #
#  # 
  #  
 #  #
#  ##
`,$:`
 ####
# #  
 ### 
  # #
#### 
`,"(":`
  #  
 #   
 #   
 #   
  #  
`,")":`
  #  
   # 
   # 
   # 
  #  
`,"[":`
  ## 
  #  
  #  
  #  
  ## 
`,"]":`
 ##  
  #  
  #  
  #  
 ##  
`,"<":`
  #  
 #   
#    
 #   
  #  
`,">":`
  #  
   # 
    #
   # 
  #  
`,"'":`
   # 
  #  
     
     
     
`,'"':`
 # # 
 # # 
     
     
     
`,"`":`
 #   
  #  
     
     
     
`,"~":`
 # #
# # 
     
     
     
`,"^":`
  #  
 # # 
     
     
     
`,"&":`
 ### 
#  # 
 ### 
#  # 
 ## #
`,\u03A8:`
# # #
# # #
 ### 
  #  
  #  
`},piterator:{A:`
  #  
 # # 
#   #
#####
#   #
`,B:`
#### 
#   #
#### 
#   #
#### 
`,C:`
 ####
#    
#    
#    
 ####
`,D:`
#### 
#   #
#   #
#   #
#### 
`,E:`
#####
#    
#### 
#    
#####
`,F:`
#####
#    
#### 
#    
#    
`,G:`
 ### 
#    
# ###
#   #
 ### 
`,H:`
#   #
#   #
#####
#   #
#   #
`,I:`
 ### 
  #  
  #  
  #  
 ### 
`,J:`
 ### 
   # 
   # 
 # # 
  #  
`,K:`
#   #
# ## 
##   
# ## 
#   #
`,L:`
#    
#    
#    
#    
#####
`,M:`
#   #
## ##
# # #
#   #
#   #
`,N:`
#   #
##  #
# # #
#  ##
#   #
`,O:`
 ### 
#   #
#   #
#   #
 ### 
`,P:`
#### 
#   #
#### 
#    
#    
`,Q:`
 ### 
#   #
# # #
#  # 
 ## #
`,R:`
#### 
#   #
#### 
# #  
#  ##
`,S:`
 ####
#    
 ### 
    #
#### 
`,T:`
#####
  #  
  #  
  #  
  #  
`,U:`
#   #
#   #
#   #
#   #
 ### 
`,V:`
#   #
#   #
#   #
 # # 
  #  
`,W:`
#   #
# # #
# # #
# # #
 # # 
`,X:`
#   #
 # # 
  #  
 # # 
#   #
`,Y:`
#   #
 # # 
  #  
  #  
  #  
`,Z:`
#####
   # 
  # 
 #   
#####
`,"0":`
 ### 
#  ##
# # #
##  #
 ### 
`,"1":`
  #  
 ##  
  #  
  #  
 ### 
`,"2":`
 ### 
#   #
  ## 
 #   
#####
`,"3":`
#### 
    #
#### 
    #
#### 
`,"4":`
   # 
  ## 
 # # 
#####
   # 
`,"5":`
#####
#    
#### 
    #
#### 
`,"6":`
 ### 
#    
#### 
#   #
 ### 
`,"7":`
#####
   # 
  #  
  #  
  #  
`,"8":`
 ### 
#   #
 ### 
#   #
 ### 
`,"9":`
 ### 
#   #
 ####
    #
 ### 
`," ":`
     
     
     
     
     
`,".":`
     
     
     
     
 #   
`,",":`
     
     
     
 #   
#    
`,"!":`
  #  
  #  
  #  
     
  #  
`,"?":`
 ####
#   #
  ## 
     
  #  
`,"#":`
 # # 
#####
 # # 
#####
 # # 
`,"/":`
    #
   # 
  #  
 #   
#    
`,"\\":`
#     
 #   
  #  
   # 
    #
`,"|":`
  #  
  #  
  #  
  #  
  #  
`,"+":`
     
  #  
 ### 
  #  
     
`,"-":`
     
     
 ### 
     
     
`,_:`
     
     
     
     
#####
`,"=":`
     
 ### 
     
 ### 
     
`,"*":`
     
 # # 
  #  
 # # 
     
`,":":`
     
  #  
     
  #  
     
`,";":`
     
  #  
     
  #  
 #   
`,"@":`
 ### 
#   #
# ## 
#    
 ####
`,"%":`
##  #
#  # 
  #  
 #  #
#  ##
`,$:`
 ####
# #  
 ### 
  # #
#### 
`,"(":`
   # 
  #  
  #  
  #  
   # 
`,")":`
 #   
  #  
  #  
  #  
 #   
`,"[":`
  ## 
  #  
  #  
  #  
  ## 
`,"]":`
 ##  
  #  
  #  
  #  
 ##  
`,"<":`
   # 
  #  
 #   
  #  
   # 
`,">":`
 #   
  #  
   # 
  #  
 #   
`,"'":`
  #  
  #  
     
     
     
`,'"':`
 # # 
 # # 
     
     
     
`,"`":`
 #   
  #  
     
     
     
`,"~":`
 # #
# # 
     
     
     
`,"^":`
  #  
 # # 
     
     
     
`,"&":`
 ##  
#  # 
 ## #
#  # 
 ## #
`,\u03A8:`
# # #
# # #
 ### 
  #  
  #  
`}},f={railway_top:`
=   ==
######
`,railway_bottom:`
######
=   ==
`,railway_1:`
%%%===
%%===%
%===%%
===%%%
`,railway_2:`
% %===
 %===%
%===  
===%% 
`,railway_3:`
 %*===
%++==%
+=== +
==* % 
`,railway_4:`
%%%===
%%=!=%
%===%%
===%%%
`,light:`
##########
#////////#
#//####//#
#/#LLLL#/#
#/#LLLL#/#
#/#LLLL#/#
#/#LLLL#/#
#//####//#
#////////#
`,light_pole:`
##########
----##----    
----##----
----##----
----##----
----##----
`,tpgod_head:`
-----######-----
---##########---
--###!####!###--
--###!####!###--
-##############-
-######!!######-
################
`,tpgod_body:`
####/#/##/#/####
-###///##///###-
--###//##//###--
--###//////###--
---###////###---
---###////###---
----###//###----
----###//###----
-----######-----
-----######-----
-----######-----
`,tpgod_tentacle_1:`
-----#-##!---/#--
----//-/  !!#--/#
/--#-#--#--/!----
-#/---/#-/#--!!!-
`,tpgod_tentacle_2:`
-----#-##!---/--#
----/-//  !!#-#/-
-#-#--#-#--/!-!--
/-/---/#-/#--!-!-
`,ground_tentacle_1:`
----------------------
----------------------
----------------------
------------/--/------
------/-----------/---
---/---------------/--
--/---------------/---
----/---------/-------
--------/-------------
`,ground_tentacle_2:`
----------------------
----------------------
------------/--/------
------/-----/--/--/---
---/--/-----------//--
--//--------------//--
--/-/---------/---/---
----/---/-----/-------
--------/-------------
`,ground_tentacle_3:`
---------------!------
------!-----#--#------
------#-----/--/--#!--
--!#--/-----/--/--/#--
--#/--/-------!---#/--
--//#---!-----#---//--
--/-/---#-----/---/---
----/---/-----/-------
--------/-------------
`,ground_tentacle_4:`
---------------!------
------!-----#--#------
------#----#/--/-##!--
--!##-/#--#-/-###-/#--
--#/--#-##-##-!--##/--
--//##--!-#--##---//--
--/-/---##----/---/---
----/---/-----/-------
--------/-------------
`,player_head_citizen:`
----########----
---##########---
---##########---
---##S##S##S#---
--SSSSSSSSSSSS--
--SSSESSSSESSS--
---SSESSSSESS---
---SSESSSSESS---
---SSSSSSSSSS---
----SSSSSSSS----
----SSSMMSSS----
-----SSSSSS-----
`,player_head_citizen_overlook:`
-------#####-
-----########
----SSSSSSSS-
--SSSESSESSS-
--SSSSSSSS---
-SSSSSSSS----
SSSMMSSS-----
SSSSSS-------
`,player_body:`
-----######-----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-####-#----
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
`,player_body_overlook:`
---------##CCC#-
-------#-#CCC#-#
------#-#CCC#-#-
-----#-#CCC#-#--
----#-#CCC#-#---
---#-#CCC#-#----
----#####-------
----#--#--------
---#--#---------
--#--#----------
-#--#-----------
#--#------------
`,arrow_down:`
---####---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
####%%####
-#%%%%%%#-
--#%%%%#--
---#%%#---
----##----
`,arrow_up:`
----##----
---#%%#---
--#%%%%#--
-#%%%%%%#-
####%%####
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---####---
`,random:(e,t)=>f[e+"_"+(~~(Math.random()*1e6)%t+1)],cat:(...e)=>(Array.isArray(e[0])?e[0]:e).map(t=>{var o;return((o=f[t])!=null?o:t).trim()}).join(`
`),cat_ex:(...e)=>(...t)=>e.map((o,r)=>{var S,h;let i=((S=f[o])!=null?S:o).trim(),n=(h=t[r])!=null?h:{};n._&&(i=i.replace(/^/mg,"-".repeat(n._)));for(let[c,_]of Object.entries(n))c!=="_"&&(i=i.replaceAll(c,_));return i}).join(`
`)}});var F=O((x,E)=>{b();var L=new Proxy(new URLSearchParams(location.search),{get:(e,t)=>e.get(t)});p.family=L.ff||"icelava";p.size=+L.fs||5;var d=750/p.size,C=["stage","move","ui"],a={_stack:[],get top(){return a._stack[a._stack.length-1]},get now(){return a.top[a.top.focus]},push:(e,t)=>{var r;if(e&&((r=a.top)==null?void 0:r.name)===e)return;let o=Object.assign([],{_focus:null,name:e,back:t});Object.defineProperty(o,"focus",{get:()=>o._focus,set:i=>{a.clear_prompt(),o._focus=i,i!==null&&a.prompt()}}),a._stack.push(o)},pop:()=>{var e,t;a._stack.length!==1&&(a.clear_prompt(),a.clear_timeout(),a._stack.pop(),(t=(e=a.top).back)==null||t.call(e,!0),a.prompt())},find:e=>a.top.findIndex(t=>t.N===e),add:e=>{a.top.push(e)},rmv:e=>{let t=a.top.find(e),o=a.top.focus;t!==-1&&(a.top.splice(t,1),o===t&&l.clear_prompt(),o>t&&a.top.focus--)},rmv_all:()=>{a.top.focus=null,a.top.length=0},prompt(){if(a.top.focus===null)return;let{x:e,y:t}=a.now;a.now.clear=l.text("ui",e-12,t,">>","+").clear},clear_prompt(e){a.top.focus!==null&&(e!=null?e:a.now).clear()},_timeout:[],timeout(e,t){a._timeout.push(setTimeout(e,t))},interval(e,t){a._timeout.push(setInterval(e,t))},clear_timeout(){a._timeout.forEach(e=>clearTimeout(e))}},R={init:`
J / DOWN      FOCUS NEXT
K / UP        FOCUS PREV
H / LEFT /    BACK
DEL / BKSP
?             FOCUS ?
SP / ENTER    ACTIVE
R             REFRESH
~C            CLEAR ALL
`},l={ctx:C.reduce((e,t)=>(e[t]=document.getElementById(t).getContext("2d"),e),{}),raw(e,t,o,r,i,n){t=m[t],t&&(l.ctx[e].fillStyle=t),l.ctx[e][t?"fillRect":"clearRect"](...[o,r,i,n].map(S=>S*p.size))},draw(e,t,o,r){typeof r=="string"&&(r=r.split(`
`)),r=r.filter((i,n)=>n!==0&&n!==r.length-1||i!=="");for(let i=0;i<r.length;i++)for(let n=0;n<r[i].length;n++)l.raw(e,r[i][n],t+n,o+i,1,1);return{clear:()=>l.draw(e,t,o,r.map(i=>i.replace(/[^-]/g,"x")))}},text(e,t,o,r,i="#",n="-",S=6,h=6){typeof r=="string"&&(r=r.split(`
`));for(let c=0;c<r.length;c++)for(let _=0;_<r[c].length;_++){let g=p[p.family][r[c][_].toUpperCase()];(i||n)&&(g=g.replaceAll("#","{").replaceAll(" ","}").replaceAll("{",i).replaceAll("}",n)),l.draw(e,t+_*S,o+c*h,g).clear}return{reg:c=>a.add({x:t,y:o,m:r[0].length*6,n:r.length*6,f:c}),reg_name:(c,_)=>{a.find(c)===-1&&a.add({N:c,x:t,y:o,m:r[0].length*6,n:r.length*6,f:_})},clear:()=>l.text(e,t,o,r,"x",n==="-"?"-":"x",S,h)}},clear(e,t=0,o=0,r=d,i=d){l.raw(e,"x",t,o,r,i)},clear_all(){C.map(e=>l.clear(e))}},w={font(){l.clear("ui",0,80),l.text("ui",1,80,Object.keys(p[p.family]).join("").replace(/[^]{17}/g,`$&
`))},color(){l.clear("ui",0,80);for(let[e,[t]]of Object.entries(m).entries())l.text("ui",1+e*6,80,t,"#"," "),l.text("ui",1+e*6,86,t,t," ")}},T={tpgod:()=>{a.push("fun:tpgod"),l.clear("ui"),s.place(10,10).move(0,0,0,0),a.timeout(()=>s.move(eval("t => "+prompt("dx = t => ...")),eval("t => "+prompt("dy = t => ...")),+prompt("ms"),+prompt("t")),1e3)},bind:()=>{u.start();let[e,t,o,r]=Array.from({length:4},y),i=new v({skin:e,eyes:t,mouth:o,cloth:r});i.place(0,1).appear().bind(),a.interval(()=>i.move(+(Math.random()>.5),~~(Math.random()*1e6)%9),6e3)}},u={title(){l.text("ui",1,1,"TROLLEY PROBLEM","!"),l.text("ui",1,7,"<<<<   EMULATOR","#")},author(){l.text("ui",1,19,"@","@"),l.text("ui",7,19,"FORK\u03A8KILLET","#"),l.text("ui",13,25,"GITHUB:FK/TPE","@").reg_name("github",()=>open("https://github.com/ForkKILLET/TrolleyProblemEmulator"))},menu(){l.text("ui",13,37,"[ START ]","+").reg_name("start",u.start),l.text("ui",13,43,"[ TEST:FONT ]","+").reg_name("test:font",w.font),l.text("ui",13,49,"[ TEST:COLOR ]","+").reg_name("test:color",w.color),l.text("ui",13,55,"[ FUN:TPGOD ]","=").reg_name("fun:tpgod",T.tpgod),l.text("ui",13,61,"[ FUN:BIND ]","=").reg_name("fun:bind",T.bind)},init(e){e||a.push("init",u.init),l.clear_all(),u.title(),u.menu(),u.author(),u.help()},railway(){[30,34,90,94].forEach(e=>{let t=e%10;for(let o=t?-4:0;o<d;o+=6)l.draw("stage",o,e,f.random("railway",4)),l.draw("stage",o,e+(t?4:-1),f["railway_"+(t?"bottom":"top")])})},light(e){l.draw("stage",100,58,f.cat_ex(...Array.from({length:3},()=>"light"),"light_pole")(...Array.from({length:3},(t,o)=>({L:"!?*"[o]===e?e:"%"}))))},help(){l.text("ui",140,1,"?","?").reg_name("help",()=>{l.clear("ui",0,80),l.text("ui",1,80,R.init.trim(),"#")})},start(){a.push("start"),l.clear("ui"),u.title(),u.railway(),u.light("*"),s.place(0,60).move(1,0,200,20)}},s={move_state:1,place(e,t){return s.x=e,s.y=t,s},move(e,t,o,r){let i=typeof e=="function"?e(r):e,n=typeof t=="function"?t(r):t,{clear:S}=l.draw("move",s.x,s.y,f.cat("tpgod_head","tpgod_body","tpgod_tentacle_"+s.move_state));return r&&a.timeout(()=>{S(),s.move_state=3-s.move_state,s.x+=i,s.y+=n,s.move(e,t,o,r-1)},o),s}},v=class{constructor(t){this.look={...t}}place(t,o){return this.r=t,this.i=o,this.y=t?85:25,this.x=15*o,this.bind_state=0,this}appear(){if(![this.x,this.y].includes())return this.disappear(),this.clear=l.draw("move",this.x,this.y,f.cat_ex("player_head_citizen_overlook","player_body_overlook")({_:10,S:this.look.skin,E:this.look.eyes,M:this.look.mouth},{C:this.look.cloth})).clear,this}disappear(){var t,o;return(t=this.clear)==null||t.call(this),(o=this.clear_bind)==null||o.call(this),this.clear=null,this.clear_bind=null,this}move(t,o){return this.disappear().place(t,o).appear()}bind(){return a.interval(()=>{this.appear(),this.bind_state++,this.bind_state===5&&(this.bind_state=1),this.clear_bind=l.draw("move",this.x-1,this.y+5,f["ground_tentacle_"+this.bind_state]).clear},900),this}};L.debug&&(window.debug={route:a,ui:l,test:w,stage:u,tpgod:s,player:v,csize:d,layers:C,color:m,random_color:y,font:p,image:f});window.addEventListener("keyup",e=>{var i;let t;switch(e.key){case"Enter":case" ":(i=a.now)==null||i.f();return;case"j":case"ArrowDown":t=1;break;case"k":case"ArrowUp":t=-1;break;case"?":a._stack.length===1&&(a.top.focus=a.find("help"));return;case"r":location.reload();return;case"C":l.clear_all();return;case"Delete":case"Backspace":case"h":case"ArrowLeft":a.pop();return;default:return}let o=a.top.length,r=a.top.focus;!o||(t&&(r=r===null?0:r+t),r===-1&&(r=o-1),r===o&&(r=0),a.top.focus=r)});l.ctx.ui.canvas.addEventListener("click",e=>{let{offsetX:t,offsetY:o}=e;t/=p.size,o/=p.size,a.top.forEach((r,i)=>{let n=t-r.x,S=o-r.y;n>=0&&n<=r.m&&S>=0&&S<=r.n&&(a.top.focus===i?r.f():a.top.focus=i)})});u.init()});F();})();
//# sourceMappingURL=bundle.js.map
