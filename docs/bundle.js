(()=>{var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var g,u,p,E=k(()=>{g={"#":"black","!":"red",".":"ivory","?":"yellow","@":"cornflowerblue","+":"forestgreen","*":"chartreuse","%":"lightgrey","/":"grey"," ":"white","=":"sienna","-":"transparent"},u={icelava:{A:`
 ### 
#   #
#####
#   #
#   #
`,B:`
#### 
#   #
#### 
#   #
#### 
`,C:`
 ####
#    
#    
#    
 ####
`,D:`
#### 
#   #
#   #
#   #
#### 
`,E:`
#####
#    
#### 
#    
#####
`,F:`
#####
#    
#### 
#    
#    
`,G:`
 ####
#    
# ###
#   #
 ####
`,H:`
#   #
#   #
#####
#   #
#   #
`,I:`
#####
  #  
  #  
  #  
#####
`,J:`
#####
   # 
   # 
#  # 
 ##  
`,K:`
#  ##
# #  
##   
# #  
#  ##
`,L:`
#    
#    
#    
#    
#####
`,M:`
#   #
## ##
# # #
#   #
#   #
`,N:`
#   #
##  #
# # #
#  ##
#   #
`,O:`
 ### 
#   #
#   #
#   #
 ### 
`,P:`
#### 
#   #
#### 
#    
#    
`,Q:`
 ### 
#   #
### #
# #  
 # ##
`,R:`
#### 
#   #
#### 
#  # 
#   #
`,S:`
 ####
#    
 ### 
    #
#### 
`,T:`
#####
  #  
  #  
  #  
  #  
`,U:`
#   #
#   #
#   #
#   #
 ### 
`,V:`
#   #
#   #
#   #
 # # 
  #  
`,W:`
#   #
# # #
# # #
# # #
 # # 
`,X:`
#   #
 # # 
  #  
 # # 
#   #
`,Y:`
#   #
 # # 
  #  
  #  
  #  
`,Z:`
#####
   # 
  # 
 #   
#####
`,"0":`
#### 
#  # 
#  # 
#  # 
#### 
`,"1":`
#    
#    
#    
#    
#    
`,"2":`
#### 
   # 
#### 
#    
#### 
`,"3":`
#### 
   # 
#### 
   # 
#### 
`,"4":`
#  # 
#  # 
#### 
   # 
   # 
`,"5":`
#### 
#    
#### 
   # 
#### 
`,"6":`
#### 
#    
#### 
#  # 
#### 
`,"7":`
#### 
   # 
  ## 
   # 
   # 
`,"8":`
#### 
#  # 
#### 
#  # 
#### 
`,"9":`
#### 
#  # 
#### 
   # 
#### 
`," ":`
     
     
     
     
     
`,".":`
     
     
     
     
 #   
`,",":`
     
     
     
 #   
#    
`,"!":`
  #  
  #  
  #  
     
  #  
`,"?":`
#####
    #
  ## 
     
  #  
`,"#":`
 # # 
#####
 # # 
#####
 # # 
`,"/":`
    #
   # 
  #  
 #   
#    
`,"\\":`
#     
 #   
  #  
   # 
    #
`,"|":`
  #  
  #  
  #  
  #  
  #  
`,"+":`
     
  #  
 ### 
  #  
     
`,"-":`
     
     
 ### 
     
     
`,_:`
     
     
     
     
 ### 
`,"=":`
     
 ### 
     
 ### 
     
`,"*":`
     
 # # 
  #  
 # # 
     
`,":":`
     
 #   
     
 #   
     
`,";":`
     
 #   
     
 #   
#    
`,"@":`
#### 
    #
 ## #
# # #
## ##
`,"%":`
##  #
#  # 
  #  
 #  #
#  ##
`,$:`
 ####
# #  
 ### 
  # #
#### 
`,"(":`
  #  
 #   
 #   
 #   
  #  
`,")":`
  #  
   # 
   # 
   # 
  #  
`,"[":`
  ## 
  #  
  #  
  #  
  ## 
`,"]":`
 ##  
  #  
  #  
  #  
 ##  
`,"<":`
  #  
 #   
#    
 #   
  #  
`,">":`
  #  
   # 
    #
   # 
  #  
`,"'":`
   # 
  #  
     
     
     
`,'"':`
 # # 
 # # 
     
     
     
`,"`":`
 #   
  #  
     
     
     
`,"~":`
 # #
# # 
     
     
     
`,"^":`
  #  
 # # 
     
     
     
`,"&":`
 ### 
#  # 
 ### 
#  # 
 ## #
`,\u03A8:`
# # #
# # #
 ### 
  #  
  #  
`},piterator:{A:`
  #  
 # # 
#   #
#####
#   #
`,B:`
#### 
#   #
#### 
#   #
#### 
`,C:`
 ####
#    
#    
#    
 ####
`,D:`
#### 
#   #
#   #
#   #
#### 
`,E:`
#####
#    
#### 
#    
#####
`,F:`
#####
#    
#### 
#    
#    
`,G:`
 ### 
#    
# ###
#   #
 ### 
`,H:`
#   #
#   #
#####
#   #
#   #
`,I:`
 ### 
  #  
  #  
  #  
 ### 
`,J:`
 ### 
   # 
   # 
 # # 
  #  
`,K:`
#   #
# ## 
##   
# ## 
#   #
`,L:`
#    
#    
#    
#    
#####
`,M:`
#   #
## ##
# # #
#   #
#   #
`,N:`
#   #
##  #
# # #
#  ##
#   #
`,O:`
 ### 
#   #
#   #
#   #
 ### 
`,P:`
#### 
#   #
#### 
#    
#    
`,Q:`
 ### 
#   #
# # #
#  # 
 ## #
`,R:`
#### 
#   #
#### 
# #  
#  ##
`,S:`
 ####
#    
 ### 
    #
#### 
`,T:`
#####
  #  
  #  
  #  
  #  
`,U:`
#   #
#   #
#   #
#   #
 ### 
`,V:`
#   #
#   #
#   #
 # # 
  #  
`,W:`
#   #
# # #
# # #
# # #
 # # 
`,X:`
#   #
 # # 
  #  
 # # 
#   #
`,Y:`
#   #
 # # 
  #  
  #  
  #  
`,Z:`
#####
   # 
  # 
 #   
#####
`,"0":`
 ### 
#  ##
# # #
##  #
 ### 
`,"1":`
  #  
 ##  
  #  
  #  
 ### 
`,"2":`
 ### 
#   #
  ## 
 #   
#####
`,"3":`
#### 
    #
#### 
    #
#### 
`,"4":`
   # 
  ## 
 # # 
#####
   # 
`,"5":`
#####
#    
#### 
    #
#### 
`,"6":`
 ### 
#    
#### 
#   #
 ### 
`,"7":`
#####
   # 
  #  
  #  
  #  
`,"8":`
 ### 
#   #
 ### 
#   #
 ### 
`,"9":`
 ### 
#   #
 ####
    #
 ### 
`," ":`
     
     
     
     
     
`,".":`
     
     
     
     
 #   
`,",":`
     
     
     
 #   
#    
`,"!":`
  #  
  #  
  #  
     
  #  
`,"?":`
 ####
#   #
  ## 
     
  #  
`,"#":`
 # # 
#####
 # # 
#####
 # # 
`,"/":`
    #
   # 
  #  
 #   
#    
`,"\\":`
#     
 #   
  #  
   # 
    #
`,"|":`
  #  
  #  
  #  
  #  
  #  
`,"+":`
     
  #  
 ### 
  #  
     
`,"-":`
     
     
 ### 
     
     
`,_:`
     
     
     
     
#####
`,"=":`
     
 ### 
     
 ### 
     
`,"*":`
     
 # # 
  #  
 # # 
     
`,":":`
     
  #  
     
  #  
     
`,";":`
     
  #  
     
  #  
 #   
`,"@":`
 ### 
#   #
# ## 
#    
 ####
`,"%":`
##  #
#  # 
  #  
 #  #
#  ##
`,$:`
 ####
# #  
 ### 
  # #
#### 
`,"(":`
   # 
  #  
  #  
  #  
   # 
`,")":`
 #   
  #  
  #  
  #  
 #   
`,"[":`
  ## 
  #  
  #  
  #  
  ## 
`,"]":`
 ##  
  #  
  #  
  #  
 ##  
`,"<":`
   # 
  #  
 #   
  #  
   # 
`,">":`
 #   
  #  
   # 
  #  
 #   
`,"'":`
  #  
  #  
     
     
     
`,'"':`
 # # 
 # # 
     
     
     
`,"`":`
 #   
  #  
     
     
     
`,"~":`
 # #
# # 
     
     
     
`,"^":`
  #  
 # # 
     
     
     
`,"&":`
 ##  
#  # 
 ## #
#  # 
 ## #
`,\u03A8:`
# # #
# # #
 ### 
  #  
  #  
`}},p={railway_top:`
=   ==
######
`,railway_bottom:`
######
=   ==
`,railway_1:`
%%%===
%%===%
%===%%
===%%%
`,railway_2:`
% %===
 %===%
%===  
===%% 
`,railway_3:`
 %*===
%++==%
+=== +
==* % 
`,railway_4:`
%%%===
%%=!=%
%===%%
===%%%
`,light:`
##########
#////////#
#//####//#
#/#LLLL#/#
#/#LLLL#/#
#/#LLLL#/#
#/#LLLL#/#
#//####//#
#////////#
`,light_pole:`
##########
----##----    
----##----
----##----
----##----
----##----
`,tpgod_head:`
-----######-----
---##########---
--###!####!###--
--###!####!###--
-##############-
-######!!######-
################
`,tpgod_body:`
####/#/##/#/####
-###///##///###-
--###//##//###--
--###//////###--
---###////###---
---###////###---
----###//###----
----###//###----
-----######-----
-----######-----
-----######-----
`,tpgod_tentacle_1:`
-----#-##!---/#--
----//-/  !!#--/#
/--#-#--#--/!----
-#/---/#-/#--!!!-
`,tpgod_tentacle_2:`
-----#-##!---/--#
----/-//  !!#-#/-
-#-#--#-#--/!-!--
/-/---/#-/#--!-!-
`,ground_tentacle_1:`
----------------------
----------------------
----------------------
------------/--/------
------/-----------/---
---/---------------/--
--/---------------/---
----/---------/-------
--------/-------------
`,ground_tentacle_2:`
----------------------
----------------------
------------/--/------
------/-----/--/--/---
---/--/-----------//--
--//--------------//--
--/-/---------/---/---
----/---/-----/-------
--------/-------------
`,ground_tentacle_3:`
---------------!------
------!-----#--#------
------#-----/--/--#!--
--!#--/-----/--/--/#--
--#/--/-------!---#/--
--//#---!-----#---//--
--/-/---#-----/---/---
----/---/-----/-------
--------/-------------
`,ground_tentacle_4:`
---------------!------
------!-----#--#------
------#----#/--/-##!--
--!##-/#--#-/-###-/#--
--#/--#-##-##-!--##/--
--//##--!-#--##---//--
--/-/---##----/---/---
----/---/-----/-------
--------/-------------
`,player_head_citizen:`
----########----
---##########---
---##########---
---##S##S##S#---
--SSSSSSSSSSSS--
--SSSESSSSESSS--
---SSESSSSESS---
---SSESSSSESS---
---SSSSSSSSSS---
----SSSSSSSS----
----SSSMMSSS----
-----SSSSSS-----
`,player_head_citizen_overlook:`
-------#####-
-----########
----SSSSSSSS-
--SSSESSESSS-
--SSSSSSSS---
-SSSSSSSS----
SSSMMSSS-----
SSSSSS-------
`,player_body:`
-----######-----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-#CC#-#----
----#-####-#----
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
------#--#------
`,player_body_overlook:`
---------##CCC#-
-------#-#CCC#-#
------#-#CCC#-#-
-----#-#CCC#-#--
----#-#CCC#-#---
---#-#CCC#-#----
----#####-------
----#--#--------
---#--#---------
--#--#----------
-#--#-----------
#--#------------
`,arrow_down:`
---####---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
####%%####
-#%%%%%%#-
--#%%%%#--
---#%%#---
----##----
`,arrow_up:`
----##----
---#%%#---
--#%%%%#--
-#%%%%%%#-
####%%####
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---#%%#---
---####---
`,random:(e,t)=>p[e+"_"+(~~(Math.random()*100)%t+1)],cat:(...e)=>(Array.isArray(e[0])?e[0]:e).map(t=>{var r;return((r=p[t])!=null?r:t).trim()}).join(`
`),cat_ex:(...e)=>(...t)=>e.map((r,o)=>{var S,h;let i=((S=p[r])!=null?S:r).trim(),n=(h=t[o])!=null?h:{};n._&&(i=i.replace(/^/mg,"-".repeat(n._)));for(let[s,_]of Object.entries(n))s!=="_"&&(i=i.replaceAll(s,_));return i}).join(`
`)}});var b=T((w,x)=>{E();var v=new Proxy(new URLSearchParams(location.search),{get:(e,t)=>e.get(t)});u.family=v.ff||"icelava";u.size=+v.fs||5;var d=750/u.size,y=["stage","move","ui"],a={_stack:[],get top(){return a._stack[a._stack.length-1]},get now(){return a.top[a.top.focus]},push:(e,t)=>{var o;if(e&&((o=a.top)==null?void 0:o.name)===e)return;let r=Object.assign([],{_focus:null,name:e,back:t});Object.defineProperty(r,"focus",{get:()=>r._focus,set:i=>{a.clear_prompt(),r._focus=i,i!==null&&a.prompt()}}),a._stack.push(r)},pop:()=>{a.clear_prompt(),a.clear_timeout();let e=a.top.back;a._stack.pop(),e==null||e(),a.prompt()},find:e=>a.top.findIndex(t=>t.n===e),add:e=>{a.top.push(e)},rmv:e=>{let t=a.top.find(e),r=a.top.focus;t!==-1&&(a.top.splice(t,1),r===t&&l.clear_prompt(),r>t&&a.top.focus--)},rmv_all:()=>{a.top.focus=null,a.top.length=0},prompt(){if(a.top.focus===null)return;let{x:e,y:t}=a.now;l.text("ui",e-12,t,">>","+")},clear_prompt(e){if(a.top.focus===null)return;let{x:t,y:r}=e!=null?e:a.now;l.clear("ui",null,t-12,r,11,5)},_timeout:[],timeout(e,t){a._timeout.push(setTimeout(e,t))},interval(e,t){a._timeout.push(setInterval(e,t))},clear_timeout(){a._timeout.forEach(e=>clearTimeout(e))}},A={init:`
J / DOWN      FOCUS NEXT
K / UP        FOCUS PREV
H / LEFT /    BACK
DEL / BKSP
?             FOCUS ?
SP / ENTER    ACTIVE
R             REFRESH
~C            CLEAR ALL
`},l={ctx:y.reduce((e,t)=>(e[t]=document.getElementById(t).getContext("2d"),e),{}),raw(e,t,r,o,i,n){t&&(l.ctx[e].fillStyle=g[t]),l.ctx[e][t?"fillRect":"clearRect"](...[r,o,i,n].map(S=>S*u.size))},draw(e,t,r,o){typeof o=="string"&&(o=o.split(`
`)),o=o.filter((i,n)=>n!==0&&n!==o.length-1||i!=="");for(let i=0;i<o.length;i++)for(let n=0;n<o[i].length;n++)l.raw(e,o[i][n],t+n,r+i,1,1)},text(e,t,r,o,i="#",n="-",S=6,h=6){typeof o=="string"&&(o=o.split(`
`));for(let s=0;s<o.length;s++)for(let _=0;_<o[s].length;_++){let m=u[u.family][o[s][_]];(i||n)&&(m=m.replaceAll("#","{").replaceAll(" ","}").replaceAll("{",i).replaceAll("}",n)),l.draw(e,t+_*S,r+s*h,m)}return{reg:s=>a.add({x:t,y:r,m:o[0].length*6,n:o.length*6,f:s}),reg_name:(s,_,m)=>{a.find(s)===-1&&a.add({x:t,y:r,m:o[0].length*6,n:o.length*6,f:m?()=>{_(),a.push(s,m)}:_})}}},clear(e,t,r=0,o=0,i=d,n=d){t&&(l.ctx[e].fillStyle=g[t]),l.raw(e,t,r,o,i,n)},clear_image(e,t,r,o){o=o.trim().split(`
`),l.clear(e,null,t,r,o[0].length,o.length)},clear_all(){y.map(e=>l.clear(e))}},C={font(){l.clear("ui",null,0,80),l.text("ui",1,80,Object.keys(u[u.family]).join("").replace(/[^]{17}/g,`$&
`))},color(){l.clear("ui",null,0,80);let e=0;for(let t of Object.keys(g))l.text("ui",1+e++*6,80,t,t," ")}},f={title(){l.text("ui",1,1,"TRAIN PROBLEM","#"),l.text("ui",1,7,"<<<< EMULATOR","!")},author(){l.text("ui",1,19,"@","@"),l.text("ui",7,19,"FORK\u03A8KILLET","#"),l.text("ui",13,25,"GITHUB:FORKFG/TPE","@").reg_name("github",()=>open("https://github.com/ForkFG/TrainProblemEmulator"))},menu(){l.text("ui",13,37,"[ START ]","+").reg_name("start",f.start,f.init),l.text("ui",13,43,"[ TEST:FONT ]","+").reg_name("test:font",C.font),l.text("ui",13,49,"[ TEST:COLOR ]","+").reg_name("test:color",C.color),l.text("ui",13,55,"[ FUN:TPGOD ]","=").reg_name("fun:tpgod",()=>{l.clear("ui"),c.place(10,10).move(0,0,0,0),a.timeout(()=>c.move(eval("t => "+prompt("dx = t => ...")),eval("t => "+prompt("dy = t => ...")),+prompt("ms"),+prompt("t")),1e3)},!0)},init(){a.push("init"),l.clear_all(),f.title(),f.menu(),f.author(),f.help()},railway(){[30,34,90,94].forEach(e=>{let t=e%10;for(let r=t?-4:0;r<d;r+=6)l.draw("stage",r,e,p.random("railway",4)),l.draw("stage",r,e+(t?4:-1),p["railway_"+(t?"bottom":"top")])})},light(e){l.draw("stage",100,58,p.cat_ex(...Array.from({length:3},()=>"light"),"light_pole")(...Array.from({length:3},(t,r)=>({L:"!?*"[r]===e?e:"%"}))))},help(){l.text("ui",140,1,"?","?").reg_name("help",()=>{l.clear("ui",null,0,80),l.text("ui",1,80,A.init.trim(),"#")})},start(){l.clear("stage"),l.clear("ui"),f.title(),f.railway(),f.light("*"),c.place(0,60).move(1,0,200,20)}},c={move_state:1,place(e,t){return c.x=e,c.y=t,c},move(e,t,r,o){let{x:i,y:n}=c,S=typeof e=="function"?e(o):e,h=typeof t=="function"?t(o):t;return l.draw("move",c.x,c.y,p.cat("tpgod_head","tpgod_body","tpgod_tentacle_"+c.move_state)),o&&a.timeout(()=>{l.clear("move"," ",i-S,n-h,17,22),c.move_state=3-c.move_state,c.x+=S,c.y+=h,c.move(e,t,r,o-1)},r),c}},L=class{constructor(t){this.look={...t},this.bind_state=0}place(t,r){return this.r=t,this.i=r,this.y=t?85:25,this.x=15*r,this}appear(){if(![this.x,this.y].includes())return l.draw("move",this.x,this.y,p.cat_ex("player_head_citizen_overlook","player_body_overlook")({_:10,S:this.look.skin,E:this.look.eyes,M:this.look.mouth},{C:this.look.cloth})),this}disappear(){return l.clear("move",null,this.x-1,this.y,20,12),this}bind(){return a.interval(()=>{this.disappear().appear(),this.bind_state++,this.bind_state===5&&(this.bind_state=1),l.draw("move",this.x-1,this.y+5,p["ground_tentacle_"+this.bind_state])},900),this}};location.protocol==="file:"&&(window.debug={route:a,ui:l,test:C,stage:f,tpgod:c,player:L,csize:d,layers:y,color:g,font:u,image:p});window.onload=f.init;window.onkeyup=e=>{var i;let t;switch(e.key){case"Enter":case" ":(i=a.now)==null||i.f();return;case"j":case"ArrowDown":t=1;break;case"k":case"ArrowUp":t=-1;break;case"?":a.top.focus=a.find("help");return;case"r":location.reload();return;case"C":l.clear_all();return;case"Delete":case"Backspace":case"h":case"ArrowLeft":a.pop();return;default:return}let r=a.top.length,o=a.top.focus;!r||(t&&(o=o===null?0:o+t),o===-1&&(o=r-1),o===r&&(o=0),a.top.focus=o)};l.ctx.ui.canvas.onclick=e=>{let{offsetX:t,offsetY:r}=e;t/=u.size,r/=u.size,a.top.forEach((o,i)=>{let n=t-o.x,S=r-o.y;n>=0&&n<=o.m&&S>=0&&S<=o.n&&(a.top.focus===i?o.f():a.top.focus=i)})}});b();})();
//# sourceMappingURL=bundle.js.map
